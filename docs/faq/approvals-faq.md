<rtl>

# أسئلة شائعة عن الموافقات 
## إعداد الموافقة على سند التحويل بناءً على المخزن المستلم

في حال وجود عدة مخازن، ولكل مخزن **أمين مخزن** ومدير مباشر مختلف، وترغب بأن تكون **الموافقة على سند التحويل من مسؤولية المخزن الذي ستُرسل إليه البضاعة** (وليس المخزن المُرسل)، يمكنك تحقيق ذلك من خلال إعداد الموافقة على النحو التالي:

### الحل

* قم بإنشاء **تعريف موافقة** للكيان `StockTransfer`.
* أضف خطوة موافقة يكون المسؤول فيها محددًا بناءً على **حقل داخل السند**.
* استخدم الحقل التالي لتحديد المسؤولين:

```
toWarehouse.warehouseKeeper,toWarehouse.warehouseKeeper.directSupervisor
```

وذلك يعني أن الموافقة ستكون من:

* **أمين المخزن المستلم**
* **المدير المباشر لأمين المخزن المستلم**

---

::: details اضغط لعرض ملف JSON للاستيراد المباشر

```json
{
  "approvalEntity": "StockTransfer",
  "steps": [
    {
      "stepSeq": 1,
      "name1": "موافقة أمين المخزن",
      "responsible": {
        "responsibleType": "Field",
        "fieldId": "toWarehouse.warehouseKeeper,toWarehouse.warehouseKeeper.directSupervisor"
      }
    }
  ]
}
```

:::

بهذا الإعداد، يقوم النظام بتوجيه طلب الموافقة تلقائيًا إلى المسؤولين المعنيين في **المخزن المستلم**، مما يضمن سير عملية الموافقة وفق التسلسل الإداري المعتمد.

## حاولت عمل موافقة "مع التعديل" لسند تحويل مخزني لكن النظام رفض الحفظ

عند تعريف موافقة لسند تحويل مخزني واختيار نوع الموافقة "مع التعديل" (Update Approval)، قد تظهر رسالة الخطأ التالية:

```
Update approval can not be used with documents, can be used with documents only  
لا يمكن استعمال "مع التعديل" مع المستندات - تستعمل مع الملفات فقط
```

### السبب

بشكل افتراضي، لا يسمح نظام Nama ERP بإجراء موافقات على تعديل المستندات (مثل سندات التحويل، الفواتير، وغيرها)، لأن تعديل المستندات بعد اعتمادها يعتبر مخاطرة وقد يفتح الباب للتلاعب. يُفضل عكس المستند ثم إصدار مستند جديد بدلاً من تعديله.

### الحل

إذا كان هناك سيناريو منطقي يستدعي السماح بتعديل المستندات مع وجود موافقة، يمكن تفعيل الخيار التالي من الإعدادات العامة:

<GlobalConfigOption option-code="value.info.allowApprovalsOnDocumentsUpdate" />

### ملاحظات إضافية

::: tip يمكنك التحكم في التعديل أو الحذف بعد الموافقة من خلال الصلاحيات

* لمنع تعديل السندات التي تمت الموافقة عليها، فعّل خيار `preventEditAfterApproval` في ملف الصلاحيات أو المستخدم.
* لمنع حذف السندات بعد الموافقة، فعّل خيار `preventDeleteAfterApproval`.

:::

</rtl>