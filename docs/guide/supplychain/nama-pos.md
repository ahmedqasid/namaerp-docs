# دليل استعمال النقاط الفنية في نقاط البيع

Nama ERP is a web-based system, but its **Nama POS** module includes a dedicated **desktop application** for Points of Sale (POS), offering both online and offline capabilities:

* POS operates offline using a local POS database.
* It automatically syncs with the Nama ERP central database.
* Integrates with payment terminals, including an embedded credit-card processor for mobile phones.
* POS functionality is available on Android and iOS via the **Captain Order** mobile app.

## Nama POS Pole Display Configuration Using Tempo


---

## POS Pole Display Setup

To configure a pole display for Nama POS, follow these steps:

1. Go to the **"Pos Pole Display Specs"** screen.
2. Set:

* **Communication Type**: e.g., Serial, USB.
* **Printer Name or Port Number**: to define the connection interface.
3. Link the pole display configuration to a machine by setting the **"Pos Pole Display Specs"** field in the machine record.

---

## Displaying Data on the Pole Display

Nama POS allows defining **template-based messages** for different events in the sales process. Templates are configured in the **"Pos Pole Display Specs"** screen.

### Supported Functions

* **Clear Line:**

```tempo
@CLEARLINE@
```

Use it to clear one line on the pole display.

**Example:**

```tempo
@CLEARLINE@@CLEARLINE@ Welcome
```

Clears two lines, then displays: `Welcome`.

* **Last Modified Line:**

```tempo
{lastModifiedLine}
```

Use this to get the most recently added invoice line.

**Example:**

```tempo
{lastModifiedLine.qty.value}
```

Gets the quantity of the last added item.

---

## Pole Display Templates

### Idle Template

Displayed when the POS is idle, before any invoice is created.

```tempo
@CLEARLINE@@CLEARLINE@**** Welcome to Register {name2}
```

Clears both lines and shows a welcome message with the register's name.

---

### Line Adding Template

Displayed when a new item is added to the invoice.

```tempo
@CLEARLINE@@CLEARLINE@
{padleft(20)}Item: {lastModifiedLine.item.name2}{endpad}
{padleft(20)}Qty: {lastModifiedLine.qty.uom.name2} - {round(lastModifiedLine.qty.value,0)}{endpad}
```

Shows item name and quantity info, padded for alignment.

---

### Total Template

Displayed when the Tender screen is opened (before payment).

```tempo
@CLEARLINE@@CLEARLINE@
{padleft(20)}Total: {round(netPrice,2)}${endpad}
```

Displays the invoice total amount.

---

### Remaining Template

Displayed after the customer pays and change is calculated.

```tempo
@CLEARLINE@@CLEARLINE@
{padleft(20)}Remaining: {round(change,2)}${endpad}
```

Displays the remaining change to be returned to the customer.

---

These templates provide a flexible way to control real-time messaging on POS displays using Tempo syntax.

<rtl>


## فلترة البحث في شاشات نقاط البيع باستخدام محددات الماكينة

في نظام نما، يتم تطبيق الفلترة تلقائيًا على محددات الدخول (مثل الشركة، الفرع، القطاع...) في الشاشات العادية.
ولكن في **نظام نقاط البيع (POS)**، لا يتم تطبيق هذه الفلاتر بشكل تلقائي، لأن النظام يعتمد على محددات الجهاز (الماكينة) بدلاً من المستخدم.

لذلك، لتفعيل الفلترة في شاشات البحث داخل نقاط البيع بناءً على محددات الماكينة، يتم استخدام **شاشة إعدادات نقاط البيع**، وتحديدًا من خلال جدول **"فلترة المحددات"**.

### مثال:

لنفترض أنك تريد فلترة **المنطقة (المستخدمة في عنوان التوصيل)** في **فاتورة مبيعات نقاط البيع** بحيث تظهر فقط المناطق المرتبطة بفرع الماكينة الحالية:

1. افتح **شاشة إعدادات نقاط البيع**.
2. في جدول **"فلترة المحددات"**:

    * أضف سطرًا جديدًا.
    * اختر النوع **"منطقة"** في حقل **النوع**.
    * في حقل **"مفلتر في النوع"**، اختر **"فاتورة مبيعات نقاط البيع"**.
    * فعّل خيار **"فلترة بالفرع"**.
3. يمكنك أيضًا إنشاء **قائمة أنواع** تحتوي على "منطقة" وأنواع بيانات أخرى لتطبيق نفس الفلترة عليها.

### الخيارات المتاحة للفلترة:

* ✅ فلترة بالشركة
* ✅ فلترة بالفرع
* ✅ فلترة بالقطاع
* ✅ فلترة بالإدارة
* ✅ فلترة بالمجموعة التحليلية

## تسجيل الدخول باستخدام API Key في نقاط البيع

أضيفت آلية جديدة لتسجيل الدخول إلى نظام نقاط البيع باستخدام **مفتاح API** بدلاً من اسم المستخدم وكلمة المرور. الهدف من هذه الآلية هو تجنّب تخزين كلمة المرور (حتى وإن كانت مشفّرة) داخل ملفات نقاط البيع، مع ضمان استمرار عمل النقاط حتى بعد تغيير كلمة المرور.

يمكن تفعيل هذه الآلية بطريقتين:

---

### الطريقة الأولى: الإنشاء التلقائي عبر تسجيل الدخول التقليدي

1. قم بتشغيل نقطة البيع باستخدام اسم المستخدم وكلمة المرور كما هو معتاد.
2. يقوم النظام تلقائيًا بـ:
   - إنشاء ملف `APICredentials`
      - الكود الخاص بالملف يتضمن معرف المستخدم الذي تم استخدامه.
   - حفظ مفتاح API داخل ملف `nama.properties`.
   - عند التشغيل، يبحث النظام أولًا عن ملف `APICredentials` بالكود المناسب، وإن وُجد يستخدمه بدلاً من إنشاء واحد جديد.

هذه الطريقة تتيح الانتقال السلس إلى تسجيل الدخول بمفتاح API دون الحاجة لأي تعديل يدوي.

---

### الطريقة الثانية: الإنشاء اليدوي

1. أنشئ ملف `APICredentials` يدويًا وعيّن فيه المستخدم الذي سيتم تنفيذ العمليات باسمه داخل نقاط البيع (قراءة / كتابة السجلات).
2. انسخ المفتاح من الملف الناتج.
3. يمكنك استخدام المفتاح في أحد المواضع التالية:
   - إدخاله في نافذة الإعدادات المبدئية بدلاً من اسم المستخدم وكلمة المرور.
   - أو وضعه مباشرة في ملف `nama.properties` الخاص بنقطة البيع:
     ```
     apiKey=dddsbddhbskbsdhdd
     ```

---

استخدام API Key يمنحك مرونة وأمانًا أكبر، خصوصًا عند الحاجة لتحديث كلمات المرور أو عند إدارة عدد كبير من نقاط البيع.

## طرق متطورة لتغيير عرض أعمدة جدول المبيعات في نظام نقاط البيع

### الطريقة اليدوية (السحب والتعديل المباشر)

- **كيفية الاستخدام**:  
  - يتم سحب حدود الأعمدة يدوياً (مشابه لبرنامج Excel) لتغيير العرض.  
  - عند تعديل العرض لأول مرة، يحفظ النظام القيم الجديدة تلقائياً في ملف:  
    ```screenProperties.properties```  
  - يمكن نسخ هذا الملف بعد ضبط جميع الحقول كما هو مطلوب.  

- **نشر التعديلات على أجهزة نقاط البيع**:  
  - **الخيار الأول**: لصق الملف يدوياً في كل جهاز.  
  - **الخيار الثاني**: الدخول إلى إعدادات النظام ← **خصائص أعمدة المبيعات** ← لصق محتويات الملف ← اختيار **"إرسال الخصائص إلى أجهزة نقاط البيع"** ← حفظ.  

- **مميزاتها**:  
  - مرنة وسريعة للتعديلات الأولية.  
  - تسمح بضبط دقيق حسب احتياجات المستخدم.  

- **عيوبها**:  
  - تتطلب تدخلاً يدوياً في حالة التحديث على عدة أجهزة.  

---

### التحكم في العرض عبر إعدادات واجهة نقاط البيع

- **كيفية الاستخدام**:  
  - في صفحة **"إعدادات واجهة نقاط البيع"**، تم إضافة عمود جديد باسم **"العرض"** لكل حقل في جدول المبيعات.  
  - يمكن تحديد حجم العمود من خلال خيارات محددة مسبقاً (مثل: صغير، صغير جداً، متوسط، كبير، ... إلخ).  
  - يتم توزيع المساحة تلقائياً بناءً على المقاس المحدد لكل حقل.  

- **متى تُستخدم؟**  
  - عند الرغبة في ضبط العرض بشكل منظم دون الحاجة للسحب اليدوي.  
  - في حالات التوزيع النسبي للحقول داخل الجدول.  

- **ماذا لو أردت السحب اليدوي مع تفعيل هذه الميزة؟**  
  - يتم ترك حقل **"العرض"** فارغاً، مما يسمح للمستخدم بتعديل الحجم يدوياً عند التشغيل.  

- **مميزاتها**:  
  - لا تحتاج إلى تعديل يدوي لكل جهاز.  
  - توفر خيارات محددة مسبقاً لتوحيد الشكل عبر الفروع.  
  - توزع المساحة تلقائياً بين الحقول.  

- **عيوبها**:  
  - أقل مرونة من الطريقة اليدوية في بعض الحالات الخاصة.  

---

# ميزة مركز الاتصال - نظام الطلبات الإلكترونية

## نظرة عامة
تحوّل ميزة مركز الاتصال ماكينات نقاط البيع إلى محطات عمل قوية لمراكز الاتصال، مما يمكّن المشغلين من استقبال الطلبات عن بُعد وإرسالها إلى ماكينات نقاط بيع أخرى للمعالجة. هذه الميزة مثالية للشركات ذات المواقع المتعددة أو خدمات التوصيل أو عمليات استقبال الطلبات المركزية.

### 1. كيفية استخدام الميزة

#### وضع مركز الاتصال

**الخطوة 1: تفعيل وضع مركز الاتصال**
- اذهب إلى ملف الماكينة وقم بتفعيل "وضع خدمة العملاء"

**الخطوة 2: إنشاء طلب**
1. ابدأ عملية بيع جديدة كالمعتاد
2. اختر الماكينة/الفرع المرسل إليها الطلب
3. أضف المنتجات ومعلومات العميل وأي تعليمات خاصة
4. بدلاً من إكمال البيع، انقر على "تعليق" أو اضغط اختصار التعليق
5. يتم إرسال الطلب تلقائياً إلى الماكينة المحددة
6. ستظهر لك رسالة تأكيد بإرسال الطلب


#### للماكينات المستقبلة

**الخطوة 1: تفعيل الاستقبال التلقائي للطلبات**
- اذهب إلى ملف الماكينة وقم بتفعيل هذا الخيار "قراءة الطلبات من مركز خدمة العملاء"

**الخطوة 2: معالجة الطلب**
1. بعد التفعيل، ستظهر الطلبات تلقائياً (يتم الفحص كل دقيقة)
2. سيظهر إشعار منبثق عند وصول طلبات جديدة
3. اذهب إلى شاشة "الطلبات المعلقة"
4. ابحث عن الطلب المستلم (محدد كمعلق)
5. افتح وراجع الطلب
6. أكمل المعالجة كعملية بيع عادية

### 2. فوائد الميزة
- **استقبال الطلبات المركزي**: استقبال الطلبات من موقع مركزي لعدة فروع
- **توزيع فعّال للطلبات**: توجيه الطلبات تلقائياً إلى الموقع المناسب
- **إشعارات فورية**: تنبيهات لحظية عند إرسال واستقبال الطلبات
- **تكامل سلس**: يعمل مع البنية التحتية الحالية لنقاط البيع
- **تحسين خدمة العملاء**: معالجة أسرع للطلبات وتقليل أوقات الانتظار

### 3. حالات الاستخدام التجارية

#### خدمات التوصيل
- مركز الاتصال يدير جميع طلبات التوصيل
- توزيع الطلبات على المواقع المناسبة
- تتبع الطلبات في الوقت الفعلي
- تحسين تنسيق التوصيل


### 4. ما يميز هذه الخاصية في نما سوفت

#### المزامنة الفورية
- نقل الطلبات فورياً إلى الخادم
- الماكينات المستهدفة تفحص الطلبات الجديدة كل دقيقة
- إعادة محاولة تلقائية في حالة مشاكل الشبكة

#### نقل كامل للطلب
- جميع المنتجات مع الكميات والأسعار
- معلومات العميل
- التعليمات والملاحظات الخاصة
- الخصومات والعروض الترويجية

#### الإشعارات الذكية
- نوافذ منبثقة مرئية لأحداث الطلبات
- رسائل خطأ واضحة في حالة المشاكل

# ميزة الأصناف الإضافية للصنف - نظام نقاط البيع

## نظرة عامة
تتيح ميزة الأصناف الإضافية للعملاء إضافة عناصر مكملة لأصناف رئيسية في نقطة البيع. يمكن ربط كل صنف بمجموعة من الأصناف الإضافية مثل الإضافات (كالسكر والحليب للقهوة)، أو الاختيارات المتعددة (كالمقاسات والألوان). هذه الميزة ضرورية للمطاعم والمقاهي ومحلات بيع الملابس.

### 1. فوائد الميزة
- **إضافات مخصصة**: إضافة عناصر مكملة لأصناف رئيسية
- **خيارات متعددة**: دعم ما يصل إلى 10 مجموعات من الأصناف الإضافية
- **مرونة في العرض**: عرض خصائص الصنف الرئيسي (الإصدارات، الألوان، المقاسات) بطرق مختلفة
- **تحكم في الواجهة**: تخصيص طريقة عرض كل مجموعة من العناصر
- **تحسين الطلبات**: تسهيل تخصيص الطلبات للعملاء

### 2. حالات الاستخدام

#### محلات الإلكترونيات
- إضافة ضمانات إضافية
- اختيار اكسسوارات مكملة
- خدمات التركيب والتوصيل
- تخصيص المواصفات التقنية

### 3. كيفية استخدام الميزة

#### إعداد الأصناف الإضافية

**الخطوة 1: إنشاء ملف الأصناف الإضافية**
1. اذهب إلى "الأصناف الإضافية للصنف في نقاط البيع"
3. أضف ملف جديد بالمعلومات التالية:
    - **الصنف الأساسي**: اختر الصنف أو المجموعة المراد ربطها

**إضافة الأصناف الإضافية**
1. في قسم "الأصناف الإضافية"، اختر المجموعة المطلوبة (1-10)
2. أضف العناصر بالمعلومات التالية:
    - **الصنف**: اختر الصنف الإضافي
    - **صنف افتراضي**: حدد إذا كان هذا الصنف مختاراً بشكل افتراضي
    - **الوحدة الافتراضية**: حدد وحدة القياس الافتراضية
3. في قسم "إعدادات الأصناف الإضافية"، أضف إعدادات كل مجموعة:
    - **نوع الأصناف الإضافية**: اختر المجموعة (1-10)
    - **العنوان في نقطة البيع**: النص الذي سيظهر للمستخدم
    - **إمكانية اختيار متعدد**: إمكانية اختيار عدة أصناف إضافية من نفس المجموعة
    - **جعل الإضافات إجبارية**: إجبار المستخدم على الاختيار
    - **إضافة زر البحث**: إضافة زر بحث للعناصر
    - **إضافة زر التصفح**: إضافة زر للتنقل بين الصفحات

**إظهار خصائص الصنف الأساسي**
1. **لإظهار الإصدارات**:
    - فعل "إظهار إصدارات الصنف"
    - حدد ترتيب الظهور
    - اختر طريقة العرض (الاسم فقط، الكود فقط، الكود والاسم)
    - أدخل عنوان الإصدارات في نقطة البيع

2. **لإظهار الألوان**:
    - فعل "إظهار ألوان الصنف"
    - حدد ترتيب الظهور
    - اختر طريقة العرض
    - أدخل عنوان الألوان في نقطة البيع

3. **لإظهار المقاسات**:
    - فعل "إظهار مقاسات الصنف"
    - حدد ترتيب الظهور
    - اختر طريقة العرض
    - أدخل عنوان المقاسات في نقطة البيع


#### استخدام الأصناف الإضافية في نقطة البيع

**الخطوة 1: اختيار الصنف الاساسي**
1. في شاشة البيع، اختر الصنف الاساسي
2. ستظهر نافذة الأصناف الإضافية تلقائياً إذا كانت مفعلة

**الخطوة 2: تحديد خصائص الصنف الأساسي إذا كانت مفعلة**
1. **اختيار الإصدار**: إذا كانت الخاصية مفعلة، اختر الإصدار المطلوب
2. **اختيار اللون**: حدد اللون المطلوب من القائمة
3. **اختيار المقاس**: حدد المقاس المناسب

**الخطوة 3: إضافة الأصناف الإضافية**
1. لكل مجموعة من الأصناف الإضافية:
    - راجع العنوان المخصص للمجموعة
    - اختر العنصر أو العناصر المطلوبة
    - استخدم البحث إذا كان متاحاً
    - تصفح الصفحات للمزيد من الخيارات

**الخطوة 4: تأكيد الاختيار**
1. راجع جميع الاختيارات
2. تأكد من اختيار العناصر الإجبارية
3. اضغط "موافق" لإضافة الصنف مع إضافاته للفاتورة

### 4. الميزات الرئيسية

#### المرونة
- دعم ما يصل إلى 10 مجموعات من الأصناف الإضافية
- تخصيص عنوان كل مجموعة
- تحديد العناصر الإجبارية والاختيارية
- دعم الاختيار المتعدد أو المفرد

#### خيارات العرض
- عرض بالاسم فقط أو الكود فقط أو كليهما
- ترتيب العرض قابل للتخصيص
- عناوين مخصصة لكل خاصية
- تحكم في عدد العناصر المعروضة في الصفحة

#### سهولة الاستخدام
- واجهة بديهية في نقطة البيع
- أزرار بحث وتصفح عند الحاجة
- إمكانية جعل الاختيارات إجبارية
- دعم التصفح بين الصفحات للمجموعات الكبيرة

#### التكامل مع المخزون
- ربط الأصناف الإضافية بنظام المخزون
- تتبع كميات الأصناف الإضافية
- حساب التكلفة الإجمالية تلقائياً
- دعم وحدات القياس المختلفة

### 5. أفضل الممارسات

#### تنظيم الأصناف الإضافية
- قم بتجميع العناصر المترابطة في مجموعة واحدة
- استخدم أسماء واضحة وسهلة الفهم للمجموعات
- رتب العناصر حسب الأهمية أو الشعبية
- تجنب إضافة عدد كبير من العناصر في مجموعة واحدة

#### تحسين تجربة المستخدم
- اجعل العناصر الأكثر شعبية مرئية أولاً
- استخدم عناوين وصفية للمجموعات
- فعّل البحث للمجموعات الكبيرة
- حدد عدد مناسب من العناصر في كل صفحة

#### إدارة العناصر الإجبارية
- اجعل الخيارات الأساسية إجبارية فقط
- وضح للمستخدم العناصر الإجبارية بشكل واضح
- تجنب جعل عدد كبير من العناصر إجبارياً
- اسمح بالاختيار المتعدد عند الضرورة فقط

## إعادة تعيين عداد محاولات الإرسال للمستندات غير المرسلة

عندما تفشل مستندات نقاط البيع في الإرسال إلى الخادم، يقوم النظام بزيادة عداد المحاولات الفاشلة (`writeFailures`). بعد 25 محاولة فاشلة (القيمة الافتراضية)، يتوقف النظام عن محاولة إرسال المستند.

لإعادة تعيين العداد والسماح للنظام بمحاولة الإرسال مرة أخرى، قم بتنفيذ الاستعلام التالي على قاعدة بيانات نقاط البيع:

```sql
UPDATE POSSalesInvoice SET writeFailures = 0 WHERE sent = 0;
UPDATE POSSalesReturn SET writeFailures = 0 WHERE sent = 0;
UPDATE POSSalesReplacement SET writeFailures = 0 WHERE sent = 0;
UPDATE POSPaymentToRegistery SET writeFailures = 0 WHERE sent = 0;
UPDATE POSReceiptFromRegistery SET writeFailures = 0 WHERE sent = 0;
UPDATE POSShiftOpen SET writeFailures = 0 WHERE sent = 0;
UPDATE POSShiftClose SET writeFailures = 0 WHERE sent = 0;
UPDATE POSCustomer SET writeFailures = 0 WHERE sent = 0;
UPDATE POSStockTransferReq SET writeFailures = 0 WHERE sent = 0;
UPDATE POSOrderReservation SET writeFailures = 0 WHERE sent = 0;
UPDATE POSCreditNote SET writeFailures = 0 WHERE sent = 0;
UPDATE POSDiscountCoupon SET writeFailures = 0 WHERE sent = 0;
UPDATE POSStockTakingDetailsDoc SET writeFailures = 0 WHERE sent = 0;
UPDATE POSStockReceipt SET writeFailures = 0 WHERE sent = 0;
UPDATE POSScrapDoc SET writeFailures = 0 WHERE sent = 0;
UPDATE POSShortfallsDoc SET writeFailures = 0 WHERE sent = 0;
UPDATE POSError SET writeFailures = 0 WHERE sent = 0;
UPDATE POSInternalMessage SET writeFailures = 0 WHERE sent = 0;
UPDATE POSInventory SET writeFailures = 0 WHERE sent = 0;
```

::: warning
تأكد من حل المشكلة الأساسية التي تسببت في فشل الإرسال (مثل مشاكل الشبكة أو إعدادات الخادم) قبل تنفيذ هذا الاستعلام.
:::
</rtl>
