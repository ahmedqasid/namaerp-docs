<rtl>

# ميزة حقل الباركود للمسح المتتالي

## نظرة عامة

تم تطوير ميزة جديدة في نظام نما لحل مشكلة فقدان التركيز (Focus) عند مسح باركود الأصناف في المتصفحات. هذه الميزة تتيح للمستخدمين مسح أكواد متعددة للأصناف بشكل متتالي دون الحاجة لإعادة التركيز على الحقل يدوياً.

## المشكلة

عند استخدام قارئ الباركود في المتصفحات، يحدث أحياناً فقدان للتركيز (Focus) من حقل كود الصنف وينتقل التركيز إلى حقول أخرى في الشاشة. هذا يؤدي إلى:
- تعطيل عملية المسح المتتالي للأصناف
- الحاجة لإعادة التركيز يدوياً على الحقل
- بطء في عملية إدخال البيانات

## الحل: حقل الباركود الذكي

### الوصف

تم إضافة حقلين جديدين إلى جميع الكيانات في النظام:

| الحقل | الاسم بالإنجليزية | الوصف |
|------|------------------|-------|
| **باركود** | Barcode | حقل نصي كبير يُستخدم لمسح أكواد الأصناف بشكل متتالي |
| **باركود خاطئ** | Invalid Barcodes | حقل نصي يحتفظ بالأكواد التي لم يتم العثور على أصناف مطابقة لها |

### المميزات الرئيسية

#### 1. الاحتفاظ التلقائي بالتركيز
- عند تفعيل حقل "باركود"، يحتفظ الحقل بالتركيز (Focus) تلقائياً
- لا ينتقل التركيز إلى حقول أخرى حتى عند اكتمال المسح
- يتيح مسح عدد غير محدود من الأكواد بشكل متتالي

#### 2. المؤشر البصري
- **خلفية خضراء**: عندما يكون الحقل نشطاً ويحتفظ بالتركيز، تكون خلفية الحقل باللون الأخضر
- يساعد اللون الأخضر المستخدم على معرفة أن الحقل جاهز لاستقبال المسح

#### 3. معالجة الأكواد غير الموجودة
- عند مسح كود غير موجود في النظام، يتم:
  - تشغيل صوت تحذيري
  - إضافة الكود تلقائياً إلى حقل "باركود خاطئ"
  - الاستمرار في الاحتفاظ بالتركيز لاستكمال المسح

#### 4. المعالجة التلقائية
- يتم معالجة كل كود ممسوح وإضافته إلى شبكة التفاصيل (Details Grid) تلقائياً
- لا حاجة لأي إجراء إضافي من المستخدم

#### 5. دعم اللصق المتعدد الأسطر
- يمكن لصق عدة أكواد في الحقل دفعة واحدة (كل كود في سطر منفصل)
- يتم معالجة جميع الأكواد الملصقة بشكل تلقائي واحداً تلو الآخر
- مفيد عند نسخ قائمة أكواد من ملف Excel أو نصي

## كيفية الاستخدام

### الخطوة 1: تفعيل الحقول في الشاشة

1. افتح شاشة الكيان المطلوب (مثل: فاتورة المبيعات، أمر الشراء، إلخ)
2. انتقل إلى **تخصيص** → **تعديل الشاشة**
3. أضف الحقلين التاليين إلى الشاشة:
   - **باركود** (barcode)
   - **باركود خاطئ** (invalidBarcodes) - اختياري

::: tip نصيحة
يُنصح بوضع حقل "باركود" في مكان بارز في الشاشة لسهولة الوصول إليه
:::

### الخطوة 2: بدء المسح

1. افتح سجل جديد أو سجل موجود
2. انقر على حقل **باركود**
3. ستلاحظ تحول لون خلفية الحقل إلى **اللون الأخضر**
4. ابدأ بمسح أكواد الأصناف باستخدام قارئ الباركود

### الخطوة 3: المسح المتتالي

- قم بمسح الأكواد واحداً تلو الآخر
- سيتم إضافة كل صنف تلقائياً إلى شبكة التفاصيل
- لا حاجة للنقر على الحقل مجدداً بين كل مسح

### الخطوة 4: الخروج من وضع المسح

للخروج من حقل الباركود والانتقال إلى حقول أخرى، استخدم أحد المفاتيح التالية:

- **مفتاح Esc** (Escape)
- **مفتاح F4**

::: warning تنبيه
لن تتمكن من الخروج من حقل الباركود بالنقر خارج الحقل أو باستخدام مفتاح Tab. يجب استخدام Esc أو F4
:::

## التفاصيل التقنية

### سلوك الحقل

| الحدث | السلوك |
|------|--------|
| **النقر على الحقل** | يبدأ وضع الاحتفاظ بالتركيز، الخلفية تصبح خضراء |
| **مسح كود صحيح** | يُضاف الصنف إلى الشبكة، يبقى التركيز على الحقل |
| **مسح كود خاطئ** | صوت تحذيري + إضافة الكود إلى "باركود خاطئ"، يبقى التركيز |
| **إدخال سطر فارغ** | الخروج من الحقل والانتقال للحقل التالي |
| **مفتاح Esc/F4** | الخروج من وضع الاحتفاظ بالتركيز |
| **مفتاح Enter/Tab** | معالجة الكود المدخل، الاحتفاظ بالتركيز |
| **Ctrl+Enter** | إدخال سطر جديد في الحقل النصي |

### متطلبات الاستخدام

::: info متطلبات
- يجب أن يحتوي الكيان على شبكة تفاصيل (Details Grid)
- يجب أن تحتوي شبكة التفاصيل على عمود **كود الصنف** (details.item.itemCode)
- يجب إضافة حقل "باركود" إلى الشاشة من خلال تعديل الشاشة
:::

## الأسئلة الشائعة

### هل يمكن استخدام الحقل في أي كيان؟
لا، يمكن استعمال الحقل فقط في مستندات التوزيع (Supply Chain) مثل فواتير المبيعات والمشتريات والتحويل المخزني.

ولكن الحقول متاحة في جميع الكيانات في النظام وقد يتم تفعيلها مستقبلا في شاشات أخرى.

### ماذا يحدث إذا لم يتم العثور على الصنف؟
- يتم تشغيل صوت تحذيري
- يُضاف الكود إلى حقل "باركود خاطئ"
- يستمر الحقل في الاحتفاظ بالتركيز لاستكمال المسح

### هل يمكن إدخال أكواد يدوياً في الحقل؟
نعم، يمكن كتابة الأكواد يدوياً. اضغط Enter بعد كل كود لمعالجته.

### هل يمكن لصق عدة أكواد دفعة واحدة؟
نعم، يمكن نسخ قائمة أكواد من ملف Excel أو ملف نصي (كل كود في سطر منفصل) ولصقها في حقل الباركود. سيتم معالجة جميع الأكواد تلقائياً واحداً تلو الآخر.

### لماذا لا يمكنني الخروج من الحقل بالنقر خارجه؟
هذا بالتصميم. الهدف هو منع فقدان التركيز غير المقصود أثناء المسح. استخدم Esc أو F4 للخروج.

### هل يمكن مسح عدة أكواد لنفس الصنف؟
نعم، سيتم إضافة كل مسح كسطر منفصل في شبكة التفاصيل.

## نصائح للاستخدام الأمثل

::: tip نصائح
1. **ضع الحقل في الأعلى**: ضع حقل "باركود" في مكان بارز في أعلى الشاشة
2. **استخدم "باركود خاطئ"**: أضف حقل "باركود خاطئ" لمتابعة الأكواد غير الصحيحة
3. **راجع القائمة**: بعد الانتهاء من المسح، راجع شبكة الأصناف للتأكد من صحة البيانات
4. **تنظيف الحقل**: احذف محتوى حقل "باركود خاطئ" بعد المعالجة
5. **اختبر القارئ**: تأكد من ضبط قارئ الباركود لإرسال Enter بعد كل مسح
:::

## ملاحظات إضافية

::: warning ملاحظات مهمة
- الحقلان "باركود" و "باركود خاطئ" هما حقول نظام (System Fields) لكنهما قابلان للتعديل
- لا يتم حفظ محتوى حقل "باركود" - فهو حقل مؤقت للإدخال فقط
- يتم حفظ محتوى حقل "باركود خاطئ" مع السجل للمراجعة لاحقاً
- الميزة متوافقة مع جميع المتصفحات الحديثة
:::

**تاريخ الإصدار**: أكتوبر 2025
**رقم الطلب**: SRDRQ05899

</rtl>