<rtl>

# الربط مع ماكينات الحضور والانصراف 
يدعم النظام طريقتين للربط مع ماكينات الحضور والانصراف
الطريقة الأولى من خلال تطبيق مخصص يتم وضعه على الأجهزة التي تقرأ البصمات من الماكينات
والطريقة الثانية من خلال ربط خادم سيكول سيرفر الحاص بالماكينات مع سيكول سيرفر الخاص بنظام نما
## الطريقة الأولى: تطبيق attcron
- هذا التطبيق بحاجة لترخيص منفصل - يرجى التواصل مع فريق المبيعات أو الدعم الفني للحصول على الترخيص

هو تطبيق مخصص يتم تنصيبه على الأجهزة التي بها برامج استيراد البيانات من ماكينات الحضور و الانصرف
وظيفته الاساسية هيا جلب البيانات من قاعدة بيانات البرنامج المحلية او من خلال واجهة البرمجة الخاصة ببرنامج الماكينة API
وارسالها بشكل دوري إلى النظام
يتميز هذا التطبيق بأنه ليس بحاجة لوجود static ip في كل الفروع التي بها ماكينات 
ولكن بالطبع يجب وجود static ip او اي طريقة تسمح للتطبيق بالوصول إلى خادم Nama ERP الريسي
خطوات التشغيل:
- قم بانشاء ملف API Credentials في نظام Nama ERP واحتفظ ب Client ID and Client Secret
- قم بانشاء ملف "إعدادات ماكينة الحضور" جديد وحدد له كود مناسب واسم واختر به نوع الاتصال
- CRON Expression وبه تستطيع تحديد متى يتم قراءة البيانات وارسالا إلى النظام
  - مثال: `5 */1 * * *` سيقوم بقراءة البيانات كل ساعة عند الدقيقة الخامسة
  - يمكنك الاستعانة بالموع التالي لعمل cron xpression المناسب لما تريده: https://crontab.guru/
- المهمة المجدولة المراد تشغيلها بعد سحب البيانات من الماكينة: وهذه التي ستقوم بجلب البيانات من جدول لوج البصمات إلى ملف الحضور والانصراف
  - لنسخ البيانات من لوج الماكينة إلى ملف الحضور و الانصراف قم بعمل مهمة مجدولة تستورد البيانات من الجدول إلى الحضورو والانصراف
  - لتسهيل انشاء المهمة تم اضافة زر باسم Create Scheduled Task 
- نوع الاتصال به 3 قيم
  - ZkBiotime ويسمح بنقل بيانات البصمة من برنامج ZK BioTime 
  - يتطلب الربط مع zk bio time التالي:
    - رابط الماكينة
    - اسم المستخدم
    - كلمة المرور
  - SQL Server ويسمح بنقل البيانات من أي ماكينة تدعم سيكول سيرفر 
  - يتطلب الربط مع SQL Server التالي:
    - رابط الماكينة: وهو عنوان خادم SQL Server - غالبا سيكون localhost
    - Database Port الخاص بالسيكول سيرفر - غالبا سيكون 1433
    - اسم المستخدم بسيكول سيرفر - غالبا سيكون sa
    - كلمة المرور الخاصة بسيكول سيرفر
    - SQL Query وهنا يمكنك اافةالاستعلام الذي سيقوم بقراءة البيانات من قاعدة بيانات الماكين عندما يقوم النظام بقراء البيانات بشكل دوري
    - Read For Period Query ويستعمل هذا الاستعلام لقراءة البيانات الخاصة بفتر محددة تقوم بتحديدها عند الضغط على زر Read Attendance For Period في تطبيق Attendance CRON على الماكينة
    - Mapping Lines: مجموعة سطور تمكنك من ربط أعمدة الاستعلام بما يقابها من البيانات التي يحتاجها النظام
      - وبه 3 أعمدة
      - Response Field: وبه الحقول التي يدعمها النظام والقيم المسوح بها فيه هي `EmployeeCode, firstName, lastName, department, punchTime, punchState, punchStateDisplay, verifyType, verifyTypeDisplay, gpsLocation, areaAlias, terminalSN, uploadTime`
      - Column Index: رقم العمود المقابل للحقل 
      - Column Alias: بديل ل Column Index ويمكنك به كتابة اسم العمود في جملة ال SQL
    - وجد زر اسم Default Queries  يقوم بوضع استعلامات افتراضية لماكينات ZK كمثال ويمكنك التعديل عليه
  - Access يسمح بنقل البيانات من قاعدة بيانات على ملف Microsoft Access
  - البيانات المطلوبة به مشابهة تماما ل SQL Server فيما عدا استبدال اسم المستخدم وكلمة المرورو ورابط الماكينة بحقل واحد وو مسار الملف (ملف قاعدة البيانات على الجهاز الذي سيتم تنصيب attendance cron عليه)
- بعد عمل هذه الخطوات يتوجب علينا الأن تنصيب برنامج ttendancce cron على الماكينة
  - اذهب الى الماكينة وقم بتنصيب JDK 21 و apache tomcat 10
  - واجعل startup type فيه Automatic
  - بعدها قم بتحميل ملف تنصيب attendance cron من الرابط التالي:
  - https://namasoft.com/bin/nama-attcron-upgrader.jar
  - ضع الملف في مجلد التومكاتن وقم بتشغيله
  - سيتم تحميل التطبيق الأن 
  - بعدها قم بالدخول الى localhost:8080/attcron
  - ستظهر لك صفحة مطلوب بها البيانات التالية:
    - Nama Server Address وبه قم بإدخال عنوان خادم نما
    - Client Id and Client Secret وبهما قم بإدخال البيانات التي احتفظت بها سابقا
    - Attendance Machine Config Code وضع به كود الماكينة الذي اخترته عند انشائها
  - التطبيق الأن جاهز لارسال البيانات إلى النظام
## الطريقة الثانية: من خلال الربط مع قاعدة بيانات SQL Server بشكل مباشر
سنعطي المثال هاهنا عن الربط مع ماكينات ZK 
ولكن الطريقة يمكن تفعيلها مع أي ماركة ماكينات تدعم تخزين بياناتها في قاعدة بيانات SQL Server
يتم تنصيب برنامج الحضور والانصراف الخاص بماكينة  (zk) على أحد خوادم المنشأة مع ملاحظة أنه لا ينبغي أن يتم تنصيب هذا البرنامج مع نفس الخادم الخاص بنظام نما سوفت حيث يفضل أن يكون خادم نما خاص بمدير النظام وأخصائيي الدعم الفني حتى لا يكون نظام نما عرضة لأي خطأ من جانب أي من المستخدمين الغير مؤهلين للتعامل مع نظام نما.

</rtl>